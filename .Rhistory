) %>% mutate(sum = rowSums(across(paste0(g25.HS_vars,"E")), na.rm = TRUE),
per = 100 * sum /summary_est) %>% arrange(GEOID) %>%
select(GEOID, paste0(g25.HS_vars,"E"), sum, summary_est, per)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = g25.HS_vars, output = "wide",
summary_var = "B15003_001" , cache_table = T
) %>% mutate(sum = rowSums(across(paste0(noedu_var,"E")), na.rm = TRUE),
per = 100 * sum /summary_est) %>% arrange(GEOID) %>%
select(GEOID, paste0(g25.HS_vars,"E"), sum, summary_est, per)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = g25.HS_vars, output = "wide",
summary_var = "B15003_001" , cache_table = T
) %>% mutate(sum = rowSums(across(paste0(noedu_var,"E")), na.rm = TRUE),
per = 100 * sum /summary_est) %>% arrange(GEOID) %>%
select(GEOID, paste0(noedu_var,"E"), sum, summary_est, per)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = noedu_var, output = "wide",
summary_var = "B15003_001" , cache_table = T
) %>% mutate(sum = rowSums(across(paste0(noedu_var,"E")), na.rm = TRUE),
per = 100 * sum /summary_est) %>% arrange(GEOID) %>%
select(GEOID, paste0(noedu_var,"E"), sum, summary_est, per)
unemp_var <- c("B23025_005")
unemp_tot <- c("B23025_002")
SVI[[16]] <- svi16_unemp <- comb(unemp_var,unemp_tot)
saveRDS(SVI,file = "SVI.RDS")
svi16_unemp <- readRDS("SVI.RDS")[[16]]
svi16_unemp %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B23025_005"), output = "wide",
summary_var = "B23025_002" , cache_table = T
) %>%  mutate(per= 100 * B23025_005E / summary_est) %>% arrange(GEOID%>%
select(GEOID, B23025_005E, summary_est, per)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B23025_005"), output = "wide",
summary_var = "B23025_002" , cache_table = T
) %>%  mutate(per= 100 * B23025_005E / summary_est) %>% arrange(GEOID) %>%
select(GEOID, B23025_005E, summary_est, per)
(vars %>% filter(grepl("B16004_",name),grepl("Speak English \"not well\"|Speak English \"not at all\"",label)))$name
(vars %>% filter(grepl("B16004_",name),grepl("Speak English \"not well\"|Speak English \"not at all\"",label)))
(vars %>% filter(grepl("B16004_",name),grepl("Speak English \"not well\"|Speak English \"not at all\"",label)))$name
esl_var <- (vars %>% filter(grepl("B16004_",name),grepl("Speak English \"not well\"|Speak English \"not at all\"",label)))$name
esl_tot <- c("B16004_001")
SVI[[17]] <- svi17_esl <- comb(esl_var,esl_tot)
saveRDS(SVI,file = "SVI.RDS")
SVI
svi17_esl <- readRDS("SVI.RDS")[[17]]
svi17_esl %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = g5.nonE_vars, output = "wide",
summary_var = "B16004_001" , cache_table = T
) %>% mutate(sum = rowSums(across(paste0(g5.nonE_vars,"E")), na.rm = TRUE),
per = 100 * sum /summary_est) %>% arrange(GEOID) %>%
select(GEOID, paste0(g5.nonE_vars,"E"), sum, summary_est, per)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = esl_var, output = "wide",
summary_var = "B16004_001" , cache_table = T
) %>% mutate(sum = rowSums(across(paste0(esl_var,"E")), na.rm = TRUE),
per = 100 * sum /summary_est) %>% arrange(GEOID) %>%
select(paste0(esl_var,"E"), sum, summary_est, per)
dis_var <- c("B23024_003","B23024_018")
dis_tot <- c("B23024_001")
SVI[[18]] <- svi18_dis <- comb(dis_var,dis_tot)
saveRDS(SVI,file = "SVI.RDS")
svi18_dis <- readRDS("SVI.RDS")[[18]]
svi18_dis %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE) %>%
head(20) %>% kbl() %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 7)
svi18_dis <- readRDS("SVI.RDS")[[18]]
svi18_dis %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B23024_003","B23024_018","B23024_001"), output = "wide",
summary_var = "B01003_001" , cache_table = T
) %>%  mutate(sum = B23024_003E + B23024_018E,
per = 100 * sum / summary_est) %>% arrange(GEOID) %>%
select(starts_with("B"), sum, summary_est, per)
blogdown:::preview_site()
readRDS("SVI.RDS")
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = F)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, mapview, kableExtra )
# crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
noveh <- readRDS("noveh.RDS")
noveh
noveh %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE) %>%
filter(per>perMOE)
noveh.sig <- noveh %>% filter(per>perMOE)
noveh.sig %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE)
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = F)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, mapview, kableExtra )
# crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
library(leafsync)
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = F)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, mapview, leafsync, kableExtra )
# crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
library(leafsync)
sync(mapview(pdx_bg_noveh, zcol = "per"), mapview(pdx_bg_noveh.sig, zcol = "per"))
pdx_bg_noveh <- pdx_bg %>% left_join(noveh,by="GEOID")
pdx_bg <- readRDS("pdx_bg.RDS")
pdx_bg_noveh <- pdx_bg %>% left_join(noveh,by="GEOID")
pdx_bg_noveh.sig <- pdx_bg %>% left_join(noveh.sig,by="GEOID")
sync(mapview(pdx_bg_noveh, zcol = "per"), mapview(pdx_bg_noveh.sig, zcol = "per"))
sync(mapview(pdx_bg_noveh, zcol = "sum"), mapview(pdx_bg_noveh.sig, zcol = "sum"))
blogdown:::preview_site()
pdx_bg_noveh.sig <- pdx_bg %>% inner_join(noveh.sig,by="GEOID")
nrow(pdx_bg_noveh.sig)
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = T)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, kableExtra )
# mapview, crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
sum_col <- function(...){
# x <- list(...) # THIS WILL BE A LIST STORING EVERYTHING:
rowSums(across(all_of(...)), na.rm = TRUE)       # Example of inbuilt function
}
sum_moe <- function(...){
sqrt(rowSums((across(all_of(...)))^2, na.rm = TRUE) )
}
Perc <- function(sum,total){
100 * sum /total
}
per_moe <- function(sum_moe,total_moe,sum,total){
100*sqrt(sum_moe^2-total_moe^2*(sum /total)^2)/total
}
comb <- function(var_list,summary_list){
var_e <- paste0(var_list,"E")
var_m <- paste0(var_list,"M")
get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = var_list, output = "wide",
summary_var = summary_list, cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(var_e),
sumMOE = sum_moe(var_m),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,sum,summary_est))
}
white_var <- c("B02001_002")
white_tot <- c("B02001_001")
SVI[[9]] <- svi9_nonwhite <- comb(white_var,white_tot) %>%
mutate(nonW.sum=summary_est-sum,
nonW.sumMOE=sqrt(summary_moe^2+sumMOE^2),
nonW.per=100-per,
nonW.perMOE= 100*sqrt((perMOE/100*summary_est)^2+summary_moe^2)/summary_est)
SVI<- readRDS("SVI.RDS")
SVI[[9]] <- svi9_nonwhite <- comb(white_var,white_tot) %>%
mutate(nonW.sum=summary_est-sum,
nonW.sumMOE=sqrt(summary_moe^2+sumMOE^2),
nonW.per=100-per,
nonW.perMOE= 100*sqrt((perMOE/100*summary_est)^2+summary_moe^2)/summary_est)
saveRDS(SVI,file = "SVI.RDS")
svi9_nonwhite %>% select(summary_est, summary_moe,
sum,sumMOE,nonW.sum,nonW.sumMOE,
per,perMOE,nonW.per,nonW.perMOE) %>%
head(20)
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = T)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, kableExtra )
# mapview, crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
# SVI<- readRDS("SVI.RDS")
SVI[[9]] <- svi9_nonwhite <- comb(white_var,white_tot) %>%
mutate(nonW.sum=summary_est-sum,
nonW.sumMOE=sqrt(summary_moe^2-sumMOE^2),
nonW.per=100-per,
nonW.perMOE= 100*sqrt(nonW.sumMOE^2-summary_moe^2*nonW.per^2)/summary_est)
saveRDS(SVI,file = "SVI.RDS")
svi9_nonwhite<- readRDS("SVI.RDS")[[9]]
svi9_nonwhite %>% select(summary_est, summary_moe,
sum,sumMOE,nonW.sum,nonW.sumMOE,
per,perMOE,nonW.per,nonW.perMOE) %>%
head(20)
get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = white_var, output = "wide",
summary_var = white_total, cache_table = T
) %>% arrange(GEOID) %>% head(20)
get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = white_var, output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID) %>% head(20)
vars <- load_variables(2019, "acs5")
View(vars)
past("B02001_00",2:9)
paste("B02001_00",2:9)
paste0("B02001_00",2:9)
get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = paste0("B02001_00",2:9), output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID) %>% head(20)
get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = paste0("B02001_00",2:9), output = "wide",
summary_var = white_tot, cache_table = T
)[,3:20] %>% arrange(GEOID) %>% head(20)
(get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = paste0("B02001_00",2:9), output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID))[,3:20] %>% head(20)
(get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = paste0("B02001_00",2:9), output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID))[,3:20] %>%
head(20) %>% kbl() %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 7)
c(paste0("B02001_00",2:9),"B02001_010")
(get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = c(paste0("B02001_00",2:9),"B02001_010"), output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID))[,3:20]
paste0("B02001_00",2:8)
(get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = paste0("B02001_00",2:8), output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID))[,3:20]
(get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = paste0("B02001_00",2:8), output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID))[,3:18]
comb(paste0("B02001_00",2:8),white_tot)
comb(paste0("B02001_00",2:8),white_tot) %>%
select(summary_est, summary_moe,
sum,sumMOE,per,perMOE) %>%
head(20) %>% kbl() %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 7)
blogdown:::preview_site()
(comb(paste0("B02001_00",3:8),white_tot))[,3:30] %>%
# select(summary_est, summary_moe,sum,sumMOE,per,perMOE) %>%
head(10)
(comb(paste0("B02001_00",3:8),white_tot))[,3:20] %>%
# select(summary_est, summary_moe,sum,sumMOE,per,perMOE) %>%
head(10)
209^2-207^2
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = T)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, kableExtra )
# mapview, crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
(trial <- get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = paste0("B02001_00",3:8), output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID))[1,3:18]
white_tot <- c("B02001_001")
(trial <- get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = paste0("B02001_00",3:8), output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID))[1,3:18]
(trial <- get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = paste0("B02001_00",2:8), output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID))[1,2:16]
trial %>% select(B02001_002M,B02001_003M,B02001_004M,B02001_005M,B02001_006M,B02001_007M,B02001_008M)
trial[1,] %>% select(B02001_002M,B02001_003M,B02001_004M,B02001_005M,B02001_006M,B02001_007M,B02001_008M)
trial[1,]
trial[1,] %>% select(B02001_002M, B02001_005M,B02001_007M,B02001_008M) %>%
mutate(nonW.sum=B02001_002M + B02001_005M+B02001_007M+B02001_008M,
nonW.sumMOE=sqrt(B02001_002M^2 + B02001_005M^2 + B02001_007M^2 + B02001_008M^2),
nonW.per=100-per,
nonW.perMOE= 100*sqrt(nonW.sumMOE^2-summary_moe^2*nonW.per^2)/summary_est)
trial[1,] %>% select(B02001_002M, B02001_005M,B02001_007M,B02001_008M) %>%
mutate(nonW.sum=B02001_002M + B02001_005M+B02001_007M+B02001_008M,
nonW.sumMOE=sqrt(B02001_002M^2 + B02001_005M^2 + B02001_007M^2 + B02001_008M^2),
nonW.per=nonW.sum/summary_est,
nonW.perMOE= 100*sqrt(nonW.sumMOE^2-summary_moe^2*nonW.per^2)/summary_est)
trial[1,] %>% # select(B02001_002M, B02001_005M,B02001_007M,B02001_008M) %>%
mutate(nonW.sum=B02001_002M + B02001_005M+B02001_007M+B02001_008M,
nonW.sumMOE=sqrt(B02001_002M^2 + B02001_005M^2 + B02001_007M^2 + B02001_008M^2),
nonW.per=nonW.sum/summary_est,
nonW.perMOE= 100*sqrt(nonW.sumMOE^2-summary_moe^2*nonW.per^2)/summary_est)
trial[1,] %>% # select(B02001_002M, B02001_005M,B02001_007M,B02001_008M) %>%
mutate(nonW.sum=B02001_002E + B02001_005E+B02001_007E+B02001_008E,
nonW.sumMOE=sqrt(B02001_002M^2 + B02001_005M^2 + B02001_007M^2 + B02001_008M^2),
nonW.per=nonW.sum/summary_est,
nonW.perMOE= 100*sqrt(nonW.sumMOE^2-summary_moe^2*nonW.per^2)/summary_est)
trial[1,] %>% # select(B02001_002M, B02001_005M,B02001_007M,B02001_008M) %>%
mutate(sum=B02001_002E + B02001_005E+B02001_007E+B02001_008E,
sumMOE=sqrt(B02001_002M^2 + B02001_005M^2 + B02001_007M^2 + B02001_008M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est)
trial[2,]
trial[2,] %>% # select(B02001_002M, B02001_005M,B02001_007M,B02001_008M) %>%
mutate(sum=B02001_002E + B02001_003E+ B02001_005E+B02001_008E,
sumMOE=sqrt(B02001_002M^2 + B02001_003M^2 + B02001_005M^2 + B02001_008M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est)
trial[8,] %>% # select(B02001_002M, B02001_005M,B02001_007M,B02001_008M) %>%
mutate(sum=B02001_002E + B02001_006E,
sumMOE=sqrt(B02001_002M^2 + B02001_006M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est)
data.frame(
trial[1,] %>% # select(B02001_002M, B02001_005M,B02001_007M,B02001_008M) %>%
mutate(sum=B02001_002E + B02001_005E+B02001_007E+B02001_008E,
sumMOE=sqrt(B02001_002M^2 + B02001_005M^2 + B02001_007M^2 + B02001_008M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est),
trial[2,] %>%
mutate(sum=B02001_002E + B02001_003E+ B02001_005E+B02001_008E,
sumMOE=sqrt(B02001_002M^2 + B02001_003M^2 + B02001_005M^2 + B02001_008M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est),
trial[8,] %>%
mutate(sum=B02001_002E + B02001_006E,
sumMOE=sqrt(B02001_002M^2 + B02001_006M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est)
)
rbind(
trial[1,] %>% # select(B02001_002M, B02001_005M,B02001_007M,B02001_008M) %>%
mutate(sum=B02001_002E + B02001_005E+B02001_007E+B02001_008E,
sumMOE=sqrt(B02001_002M^2 + B02001_005M^2 + B02001_007M^2 + B02001_008M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est),
trial[2,] %>%
mutate(sum=B02001_002E + B02001_003E+ B02001_005E+B02001_008E,
sumMOE=sqrt(B02001_002M^2 + B02001_003M^2 + B02001_005M^2 + B02001_008M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est),
trial[8,] %>%
mutate(sum=B02001_002E + B02001_006E,
sumMOE=sqrt(B02001_002M^2 + B02001_006M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est)
)
rbind(
trial[1,] %>% # select(B02001_002M, B02001_005M,B02001_007M,B02001_008M) %>%
mutate(sum=B02001_002E + B02001_005E+B02001_007E+B02001_008E,
sumMOE=sqrt(B02001_002M^2 + B02001_005M^2 + B02001_007M^2 + B02001_008M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est),
trial[2,] %>%
mutate(sum=B02001_002E + B02001_003E+ B02001_005E+B02001_008E,
sumMOE=sqrt(B02001_002M^2 + B02001_003M^2 + B02001_005M^2 + B02001_008M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est),
trial[8,] %>%
mutate(sum=B02001_002E + B02001_006E,
sumMOE=sqrt(B02001_002M^2 + B02001_006M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est)
) %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE) %>%
kbl() %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 7)
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = T)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, kableExtra )
# mapview, crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
(trial <- get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = paste0("B02001_00",2:8), output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID))[1,2:16]
white_var <- c("B02001_002")
white_tot <- c("B02001_001")
(trial <- get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = paste0("B02001_00",2:8), output = "wide",
summary_var = white_tot, cache_table = T
) %>% arrange(GEOID))[1,2:16]
rbind(
trial[1,] %>% # select(B02001_002M, B02001_005M,B02001_007M,B02001_008M) %>%
mutate(sum=B02001_002E + B02001_005E+B02001_007E+B02001_008E,
sumMOE=sqrt(B02001_002M^2 + B02001_005M^2 + B02001_007M^2 + B02001_008M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est),
trial[2,] %>%
mutate(sum=B02001_002E + B02001_003E+ B02001_005E+B02001_008E,
sumMOE=sqrt(B02001_002M^2 + B02001_003M^2 + B02001_005M^2 + B02001_008M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est),
trial[8,] %>%
mutate(sum=B02001_002E + B02001_006E,
sumMOE=sqrt(B02001_002M^2 + B02001_006M^2),
per=sum/summary_est,
perMOE= 100*sqrt(sumMOE^2-summary_moe^2*per^2)/summary_est)
) %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE) %>%
kbl() %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 7)
(comb(paste0("B02001_00",3:8),white_tot))[,3:20] %>%
# select(summary_est, summary_moe,sum,sumMOE,per,perMOE) %>%
head(10) %>% kbl() %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 7)
sum_col <- function(...){
# x <- list(...) # THIS WILL BE A LIST STORING EVERYTHING:
rowSums(across(all_of(...)), na.rm = TRUE)       # Example of inbuilt function
}
sum_moe <- function(...){
sqrt(rowSums((across(all_of(...)))^2, na.rm = TRUE) )
}
Perc <- function(sum,total){
100 * sum /total
}
per_moe <- function(sum_moe,total_moe,sum,total){
100*sqrt(sum_moe^2-total_moe^2*(sum /total)^2)/total
}
comb <- function(var_list,summary_list){
var_e <- paste0(var_list,"E")
var_m <- paste0(var_list,"M")
get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = var_list, output = "wide",
summary_var = summary_list, cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(var_e),
sumMOE = sum_moe(var_m),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,sum,summary_est))
}
nonwhite_var <- paste0("B02001_00",3:8)
vars %>% filter(name %in% c(nonwhite_tot,white_var))
vars <- load_variables(2019, "acs5")
vars %>% filter(name %in% c(nonwhite_tot,white_var))
vars %>% filter(name %in% c(white_tot,nonwhite_var))
