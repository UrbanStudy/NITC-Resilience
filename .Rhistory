sum(across(...), na.rm = TRUE)       # Example of inbuilt function
}
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B25044_003","B25044_010"), output = "wide",
summary_var = "B25044_001", cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(c("B25044_003E","B25044_010E")),
sumMOE = sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est))
sum_col <- function(...){
# x <- list(...) # THIS WILL BE A LIST STORING EVERYTHING:
rowSums(across(...), na.rm = TRUE)       # Example of inbuilt function
}
moe_sum <- function(...){
# x <- list(...) # THIS WILL BE A LIST STORING EVERYTHING:
sqrt(rowSums((across(...))^2, na.rm = TRUE) )      # Example of inbuilt function
}
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B25044_003","B25044_010"), output = "wide",
summary_var = "B25044_001", cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(c("B25044_003E","B25044_010E")),
sumMOE = sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est))
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B25044_003","B25044_010"), output = "wide",
summary_var = "B25044_001", cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(c("B25044_003E","B25044_010E")),
sumMOE = moe_sum(c("B25044_003M","B25044_010M")), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est))
sum_moe <- function(...){
sqrt(rowSums((across(...))^2, na.rm = TRUE) )
}
per_moe <- function(sum_moe,total_moe,per,total){
sqrt(sum_moe^2-total_moe^2*per^2)/total
}
noveh_e <- c("B25044_003E","B25044_010E")
noveh_m <- c("B25044_003M","B25044_010M")
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B25044_003","B25044_010"), output = "wide",
summary_var = "B25044_001", cache_table = T
) %>% arrange(GEOID)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B25044_003","B25044_010"), output = "wide",
summary_var = "B25044_001", cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(noveh_e),
sumMOE = moe_sum(noveh_m), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est),
perMOE=per_moe(sum_MOE,summary_moe,per,summary_est))
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B25044_003","B25044_010"), output = "wide",
summary_var = "B25044_001", cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(noveh_e),
sumMOE = moe_sum(noveh_m), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,per,summary_est))
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B25044_003","B25044_010"), output = "wide",
summary_var = "B25044_001", cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(noveh_e),
sumMOE = sum_moe(noveh_m), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,per,summary_est))
28.635642^2
2.4945770^2*(87)^2
(2.4945770/100)^2*(87)^2
per_moe <- function(sum_moe,total_moe,sum,total){
sqrt(sum_moe^2-total_moe^2*(sum /total)^2)/total
}
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B25044_003","B25044_010"), output = "wide",
summary_var = "B25044_001", cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(noveh_e),
sumMOE = sum_moe(noveh_m), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,sum,summary_est))
per_moe <- function(sum_moe,total_moe,sum,total){
100*sqrt(sum_moe^2-total_moe^2*(sum /total)^2)/total
}
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B25044_003","B25044_010"), output = "wide",
summary_var = "B25044_001", cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(noveh_e),
sumMOE = sum_moe(noveh_m), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,sum,summary_est))
var_list <- c("B25044_003","B25044_010")
var_e <- paste0(var_list,"E")
var_m <- paste0(var_list,"M")
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B25044_003","B25044_010"), output = "wide",
summary_var = "B25044_001", cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(var_e),
sumMOE = sum_moe(var_m), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,sum,summary_est))
summary_list <- c("B25044_001")
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = var_list, output = "wide",
summary_var = summary_list, cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(var_e),
sumMOE = sum_moe(var_m), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,sum,summary_est))
comb <- function(var_list,summary_list){
var_e <- paste0(var_list,"E")
var_m <- paste0(var_list,"M")
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = var_list, output = "wide",
summary_var = summary_list, cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(var_e),
sumMOE = sum_moe(var_m), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,sum,summary_est))
}
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = F)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, mapview, kableExtra )
# crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
# tri_cou <- c(Multnomah = "41051", Washington = "41067", Clackamas = "41005") #, Yamhill = "41071" , Clark = "53011"
tri_cou <- c('051','067','005')# "Multnomah", "Washington", "Clackamas"
vars <- load_variables(2019, "acs5")
sum_col <- function(...){
# x <- list(...) # THIS WILL BE A LIST STORING EVERYTHING:
rowSums(across(...), na.rm = TRUE)       # Example of inbuilt function
}
sum_moe <- function(...){
sqrt(rowSums((across(...))^2, na.rm = TRUE) )
}
Perc <- function(sum,total){
100 * sum /total
}
per_moe <- function(sum_moe,total_moe,sum,total){
100*sqrt(sum_moe^2-total_moe^2*(sum /total)^2)/total
}
var_list <- c("B25044_003","B25044_010")
summary_list <- c("B25044_001")
comb <- function(var_list,summary_list){
var_e <- paste0(var_list,"E")
var_m <- paste0(var_list,"M")
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = var_list, output = "wide",
summary_var = summary_list, cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(var_e),
sumMOE = sum_moe(var_m), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,sum,summary_est))
}
noveh<- comb(var_list,summary_list)
vars_e
all_of(var_list)
var_list
sum_col <- function(...){
# x <- list(...) # THIS WILL BE A LIST STORING EVERYTHING:
rowSums(across(all_of(...)), na.rm = TRUE)       # Example of inbuilt function
}
sum_moe <- function(...){
sqrt(rowSums((across(all_of(...)))^2, na.rm = TRUE) )
}
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = var_list, output = "wide",
summary_var = summary_list, cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(var_e),
sumMOE = sum_moe(var_m), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,sum,summary_est))
comb <- function(var_list,summary_list){
var_e <- paste0(var_list,"E")
var_m <- paste0(var_list,"M")
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = var_list, output = "wide",
summary_var = summary_list, cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(var_e),
sumMOE = sum_moe(var_m), # sqrt(B25044_003M^2+B25044_010M^2),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,sum,summary_est))
}
noveh<- comb(var_list,summary_list)
noveh
noveh
noveh_var <- c("B25044_003","B25044_010")
noveh_tot <- c("B25044_001")
vars %>% filter(name %in% c(noveh_tot,noveh_var))
noveh<- comb(noveh_var,noveh_tot)
noveh
saveRDS(noveh,file = "noveh.RDS")
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B25044_003","B25044_010"), output = "wide",
summary_var = "B25044_001", cache_table = T
) %>% arrange(GEOID) %>%
mutate(noveh = B25044_003E + B25044_010E,
noveh.per = 100 * noveh /summary_est) %>%
select(GEOID,B25044_003E,B25044_010E,noveh,summary_est,noveh.per)
noveh
noveh <- readRDS("noveh.RDS")
noveh
noveh %>% select(sum,sumMOE,per,perMOE) %>% head(20)
View(vars)
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = T)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, kableExtra )
# mapview, crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B26101_001"), output = "wide",
summary_var = "B01003_001" , cache_table = T
) %>%  mutate(per= 100 * B26001_001E / summary_est)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B26101_001"), output = "wide",
summary_var = "B01003_001" , cache_table = T
)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B26101_012"), output = "wide",
summary_var = "B01003_001" , cache_table = T
)
# pdx_bg <- pdx_bg %>% filter(str_sub(GEOID10, 1, 5)  %in% tri_cou)
saveRDS(noveh,file = "pdx_bg.RDS")
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = F)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, mapview, kableExtra )
# crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
noveh <- readRDS("noveh.RDS")
noveh %>% select(sum,sumMOE,per,perMOE) %>% head(20)
blogdown:::preview_site()
pdx_bg <- readRDS("pdx_bg.RDS")
pdx_bg_noveh <- pdx_bg %>% left_join(noveh,by="GEOID")
pdx_bg_noveh
noveh
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = T)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, kableExtra )
# mapview, crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
child_var <- c("B09002_008")
child_tot <- c("B09002_001")
svi1_child <- comb(child_var,child_tot)
sum_col <- function(...){
# x <- list(...) # THIS WILL BE A LIST STORING EVERYTHING:
rowSums(across(all_of(...)), na.rm = TRUE)       # Example of inbuilt function
}
sum_moe <- function(...){
sqrt(rowSums((across(all_of(...)))^2, na.rm = TRUE) )
}
Perc <- function(sum,total){
100 * sum /total
}
per_moe <- function(sum_moe,total_moe,sum,total){
100*sqrt(sum_moe^2-total_moe^2*(sum /total)^2)/total
}
comb <- function(var_list,summary_list){
var_e <- paste0(var_list,"E")
var_m <- paste0(var_list,"M")
get_acs(
state = "41",
county = c('051','067','005'), # tri_cou,
geography = "block group",
variables = var_list, output = "wide",
summary_var = summary_list, cache_table = T
) %>% arrange(GEOID) %>%
mutate(sum =sum_col(var_e),
sumMOE = sum_moe(var_m),
per = Perc(sum,summary_est),
perMOE=per_moe(sumMOE,summary_moe,sum,summary_est))
}
svi1_child <- comb(child_var,child_tot)
svi1_child %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE) %>%
head(20) %>% kbl() %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 7)
svi1_child %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = "B09002_008", output = "wide",
summary_var = "B09002_001" , cache_table = T
) %>%  mutate(per= 100 * B09002_008E / summary_est)
# tri_cou <- c(Multnomah = "41051", Washington = "41067", Clackamas = "41005") #, Yamhill = "41071" , Clark = "53011"
tri_cou <- c('051','067','005')# "Multnomah", "Washington", "Clackamas"
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = "B09002_008", output = "wide",
summary_var = "B09002_001" , cache_table = T
) %>%  mutate(per= 100 * B09002_008E / summary_est)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = "B09002_008", output = "wide",
summary_var = "B09002_001" , cache_table = T
) %>%  mutate(per= 100 * B09002_008E / summary_est) %>% arrange(GEOID) %>%
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = "B09002_008", output = "wide",
summary_var = "B09002_001" , cache_table = T
) %>%  mutate(per= 100 * B09002_008E / summary_est) %>% arrange(GEOID)
l5_var <- c("B01001_003", "B01001_027")
l5_tot <- c("B01001_001")
svi2_l5 <- comb(l5_var,l5_tot)
svi2_l5 %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B01001_003", "B01001_027"), output = "wide",
summary_var = "B01001_001" , cache_table = T
) %>%  mutate(sum = B01001_003E + B01001_027E ,
per= 100 * sum / summary_est) %>%
select(GEOID,B01001_003E, B01001_027E, sum, summary_est, per)
l5_var <- c("B01001_003", "B01001_027")
l5_tot <- c("B01001_001")
svi2_l5 <- comb(l5_var,l5_tot)
svi2_l5 %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B01001_003", "B01001_027"), output = "wide",
summary_var = "B01001_001" , cache_table = T
) %>%  mutate(sum = B01001_003E + B01001_027E ,
per= 100 * sum / summary_est) %>% arrange(GEOID)
SVI <- vector(mode = "list", length = 18)
SVI
SVI[1]
SVI[1] <- svi1_child
SVI[1]
svi1_child
bind_rows(tibbleList)
lst(rep(NULL,18))
lst(rep(NA,18))
lst(rep(2,18))
lst(1:18)
lst(all_of(1:18))
all_of(1:18)
lst(as.character(1:18))
lst(svi1,svi2)
lst(svi1=NULL,svi2=NULL)
tibble(1:18)
tibble(1:18) %>% split
tibble(1:18) %>% split(18)
bind_rows(tibble(1:18))
tibble(1:18)
tibble(1:18) %>% group_split(row_number(), .keep = FALSE)
tibble(1:18) %>% group_split(row_number(), .keep = FALSE) %>% lst()
tibble(rep(NULL,18))
tibble(rep(NA,18))
tibble(rep(NA,18)) %>% group_split(row_number(), .keep = FALSE)
SVI <- tibble(rep(NA,18)) %>% group_split(row_number(), .keep = FALSE) # %>% lst()
SVI[1] <- svi1_child
svi1_child %>% as.list()
SVI
SVI[1] <- svi1_child
SVI <- list()
SVI
lst <- list()
for (i in 1:18) {
lst[i] <- list(get(i))
}
df_names <- 1:18 # yours dataframes names character vector
lst <- list()
for (i in df_names) {
lst[i] <- list(get(i))
}
df_names <- c("a","b","c") # yours dataframes names character vector
lst <- list()
for (i in df_names) {
lst[i] <- list(get(i))
}
SVI <- lst()
SVI
SVI[1] <- svi1_child
SVI
SVI[[1]] <- svi1_child
SVI
SVI[[2]] <- svi1_child
SVI
readRDS("SVI.RDS")[[1]]
(readRDS("SVI.RDS"))[[1]]
svi2_l5
SVI[[2]] <- svi2_l5
SVI
SVI
saveRDS(SVI,file = "SVI.RDS")
readRDS("SVI.RDS")[[1]]
readRDS("SVI.RDS")[[2]]
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("B01001_003", "B01001_027"), output = "wide",
summary_var = "B01001_001" , cache_table = T
) %>%  mutate(sum = B01001_003E + B01001_027E ,
per= 100 * sum / summary_est) %>% arrange(GEOID)
vars %>% filter(name=="C21007_017")
vars %>% dplyr::filter(name=="C21007_017")
vars <- load_variables(2019, "acs5")
vars %>% dplyr::filter(name=="C21007_017")
g65_var <- c("C21007_017")
g65_tot <- c("B01003_001")
vars %>% filter(name %in% c(g65_tot, g65_var))
SVI[[3]] <- svi3_g65 <- comb(g65_var,g65_tot)
saveRDS(SVI,file = "SVI.RDS")
svi3_g65 <- readRDS("SVI.RDS")[[3]]
svi3_g65 %>% select(summary_est, summary_moe, sum,sumMOE,per,perMOE)
get_acs(
state = "41",
county = tri_cou,
geography = "block group",
variables = c("C21007_017"), output = "wide", # age_vet_pov$name
summary_var = "B01003_001" , cache_table = T
) %>%  mutate(per = 100 * C21007_017E / summary_est) %>% arrange(GEOID)
SVI
knitr::opts_chunk$set(echo = TRUE,message=F,warning = F,cache = T)
if (!require(pacman)) {install.packages("pacman"); library(pacman)}
p_load(tidyverse, tidycensus, tigris, kableExtra )
# mapview, crsuggest,
# remotes::install_github("walkerke/crsuggest")
# remotes::install_github("walkerke/tidycensus")
# devtools::install_github('walkerke/tigris')
options(tigris_use_cache = TRUE)
rappdirs::user_cache_dir('tigris')
vars %>% filter(str_detect(name, "B17017"),grepl("65 years and over",label),grepl("below poverty",label))
